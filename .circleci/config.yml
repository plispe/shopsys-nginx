defaults: &defaults
  docker:
    - image: petrpliska/shopsys-buildpack:0.1.0
      auth:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
  working_directory: ~/source

version: 2
jobs:
  deploy-to-k8s:
    <<: *defaults
    steps:
      - run:
          name: Build docker image
          command: docker image build --build-arg version=$CIRCLE_SHA1 --tag $DOCKER_REPOSITORY:$CIRCLE_BRANCH-$CIRCLE_SHA1 --tag $DOCKER_REPOSITORY:latest .
      - run:
          name: Deploy to k8s
          command: echo "Deploy yeaaaah"

workflows:
  version: 2
  deployment:
    jobs:
      - deploy-to-k8s:
          filters:
            tags:
              ignore: /.*/